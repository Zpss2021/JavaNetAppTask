(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):(global=global||self,factory(global.openNewsapp={}))})(this,function(exports){"use strict";var commonjsGlobal=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function unwrapExports(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x["default"]:x}function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}function select(element){var selectedText;if(element.nodeName==="SELECT"){element.focus();selectedText=element.value}else if(element.nodeName==="INPUT"||element.nodeName==="TEXTAREA"){var isReadOnly=element.hasAttribute("readonly");if(!isReadOnly){element.setAttribute("readonly","")}element.select();element.setSelectionRange(0,element.value.length);if(!isReadOnly){element.removeAttribute("readonly")}selectedText=element.value}else{if(element.hasAttribute("contenteditable")){element.focus()}var selection=window.getSelection();var range=document.createRange();range.selectNodeContents(element);selection.removeAllRanges();selection.addRange(range);selectedText=selection.toString()}return selectedText}var select_1=select;var clipboardAction=createCommonjsModule(function(module,exports){(function(global,factory){{factory(module,select_1)}})(commonjsGlobal,function(module,_select){var _select2=_interopRequireDefault(_select);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var ClipboardAction=function(){function ClipboardAction(options){_classCallCheck(this,ClipboardAction);this.resolveOptions(options);this.initSelection()}_createClass(ClipboardAction,[{key:"resolveOptions",value:function resolveOptions(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.action=options.action;this.container=options.container;this.emitter=options.emitter;this.target=options.target;this.text=options.text;this.trigger=options.trigger;this.selectedText=""}},{key:"initSelection",value:function initSelection(){if(this.text){this.selectFake()}else if(this.target){this.selectTarget()}}},{key:"selectFake",value:function selectFake(){var _this=this;var isRTL=document.documentElement.getAttribute("dir")=="rtl";this.removeFake();this.fakeHandlerCallback=function(){return _this.removeFake()};this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||true;this.fakeElem=document.createElement("textarea");this.fakeElem.style.fontSize="12pt";this.fakeElem.style.border="0";this.fakeElem.style.padding="0";this.fakeElem.style.margin="0";this.fakeElem.style.position="absolute";this.fakeElem.style[isRTL?"right":"left"]="-9999px";var yPosition=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=yPosition+"px";this.fakeElem.setAttribute("readonly","");this.fakeElem.value=this.text;this.container.appendChild(this.fakeElem);this.selectedText=(0,_select2.default)(this.fakeElem);this.copyText()}},{key:"removeFake",value:function removeFake(){if(this.fakeHandler){this.container.removeEventListener("click",this.fakeHandlerCallback);this.fakeHandler=null;this.fakeHandlerCallback=null}if(this.fakeElem){this.container.removeChild(this.fakeElem);this.fakeElem=null}}},{key:"selectTarget",value:function selectTarget(){this.selectedText=(0,_select2.default)(this.target);this.copyText()}},{key:"copyText",value:function copyText(){var succeeded=void 0;try{succeeded=document.execCommand(this.action)}catch(err){succeeded=false}this.handleResult(succeeded)}},{key:"handleResult",value:function handleResult(succeeded){this.emitter.emit(succeeded?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function clearSelection(){if(this.trigger){this.trigger.focus()}window.getSelection().removeAllRanges()}},{key:"destroy",value:function destroy(){this.removeFake()}},{key:"action",set:function set(){var action=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"copy";this._action=action;if(this._action!=="copy"&&this._action!=="cut"){throw new Error('Invalid "action" value, use either "copy" or "cut"')}},get:function get(){return this._action}},{key:"target",set:function set(target){if(target!==undefined){if(target&&(typeof target==="undefined"?"undefined":_typeof(target))==="object"&&target.nodeType===1){if(this.action==="copy"&&target.hasAttribute("disabled")){throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute')}if(this.action==="cut"&&(target.hasAttribute("readonly")||target.hasAttribute("disabled"))){throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes')}this._target=target}else{throw new Error('Invalid "target" value, use a valid Element')}}},get:function get(){return this._target}}]);return ClipboardAction}();module.exports=ClipboardAction})});unwrapExports(clipboardAction);function E(){}E.prototype={on:function(name,callback,ctx){var e=this.e||(this.e={});(e[name]||(e[name]=[])).push({fn:callback,ctx:ctx});return this},once:function(name,callback,ctx){var self=this;function listener(){self.off(name,listener);callback.apply(ctx,arguments)}listener._=callback;return this.on(name,listener,ctx)},emit:function(name){var data=[].slice.call(arguments,1);var evtArr=((this.e||(this.e={}))[name]||[]).slice();var i=0;var len=evtArr.length;for(i;i<len;i++){evtArr[i].fn.apply(evtArr[i].ctx,data)}return this},off:function(name,callback){var e=this.e||(this.e={});var evts=e[name];var liveEvents=[];if(evts&&callback){for(var i=0,len=evts.length;i<len;i++){if(evts[i].fn!==callback&&evts[i].fn._!==callback)liveEvents.push(evts[i])}}liveEvents.length?e[name]=liveEvents:delete e[name];return this}};var tinyEmitter=E;var is=createCommonjsModule(function(module,exports){exports.node=function(value){return value!==undefined&&value instanceof HTMLElement&&value.nodeType===1};exports.nodeList=function(value){var type=Object.prototype.toString.call(value);return value!==undefined&&(type==="[object NodeList]"||type==="[object HTMLCollection]")&&"length"in value&&(value.length===0||exports.node(value[0]))};exports.string=function(value){return typeof value==="string"||value instanceof String};exports.fn=function(value){var type=Object.prototype.toString.call(value);return type==="[object Function]"}});var is_1=is.node;var is_2=is.nodeList;var is_3=is.string;var is_4=is.fn;var DOCUMENT_NODE_TYPE=9;if(typeof Element!=="undefined"&&!Element.prototype.matches){var proto=Element.prototype;proto.matches=proto.matchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector||proto.webkitMatchesSelector}function closest(element,selector){while(element&&element.nodeType!==DOCUMENT_NODE_TYPE){if(typeof element.matches==="function"&&element.matches(selector)){return element}element=element.parentNode}}var closest_1=closest;function _delegate(element,selector,type,callback,useCapture){var listenerFn=listener.apply(this,arguments);element.addEventListener(type,listenerFn,useCapture);return{destroy:function(){element.removeEventListener(type,listenerFn,useCapture)}}}function delegate(elements,selector,type,callback,useCapture){if(typeof elements.addEventListener==="function"){return _delegate.apply(null,arguments)}if(typeof type==="function"){return _delegate.bind(null,document).apply(null,arguments)}if(typeof elements==="string"){elements=document.querySelectorAll(elements)}return Array.prototype.map.call(elements,function(element){return _delegate(element,selector,type,callback,useCapture)})}function listener(element,selector,type,callback){return function(e){e.delegateTarget=closest_1(e.target,selector);if(e.delegateTarget){callback.call(element,e)}}}var delegate_1=delegate;function listen(target,type,callback){if(!target&&!type&&!callback){throw new Error("Missing required arguments")}if(!is.string(type)){throw new TypeError("Second argument must be a String")}if(!is.fn(callback)){throw new TypeError("Third argument must be a Function")}if(is.node(target)){return listenNode(target,type,callback)}else if(is.nodeList(target)){return listenNodeList(target,type,callback)}else if(is.string(target)){return listenSelector(target,type,callback)}else{throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}}function listenNode(node,type,callback){node.addEventListener(type,callback);return{destroy:function(){node.removeEventListener(type,callback)}}}function listenNodeList(nodeList,type,callback){Array.prototype.forEach.call(nodeList,function(node){node.addEventListener(type,callback)});return{destroy:function(){Array.prototype.forEach.call(nodeList,function(node){node.removeEventListener(type,callback)})}}}function listenSelector(selector,type,callback){return delegate_1(document.body,selector,type,callback)}var listen_1=listen;var clipboard=createCommonjsModule(function(module,exports){(function(global,factory){{factory(module,clipboardAction,tinyEmitter,listen_1)}})(commonjsGlobal,function(module,_clipboardAction,_tinyEmitter,_goodListener){var _clipboardAction2=_interopRequireDefault(_clipboardAction);var _tinyEmitter2=_interopRequireDefault(_tinyEmitter);var _goodListener2=_interopRequireDefault(_goodListener);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Clipboard=function(_Emitter){_inherits(Clipboard,_Emitter);function Clipboard(trigger,options){_classCallCheck(this,Clipboard);var _this=_possibleConstructorReturn(this,(Clipboard.__proto__||Object.getPrototypeOf(Clipboard)).call(this));_this.resolveOptions(options);_this.listenClick(trigger);return _this}_createClass(Clipboard,[{key:"resolveOptions",value:function resolveOptions(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.action=typeof options.action==="function"?options.action:this.defaultAction;this.target=typeof options.target==="function"?options.target:this.defaultTarget;this.text=typeof options.text==="function"?options.text:this.defaultText;this.container=_typeof(options.container)==="object"?options.container:document.body}},{key:"listenClick",value:function listenClick(trigger){var _this2=this;this.listener=(0,_goodListener2.default)(trigger,"click",function(e){return _this2.onClick(e)})}},{key:"onClick",value:function onClick(e){var trigger=e.delegateTarget||e.currentTarget;if(this.clipboardAction){this.clipboardAction=null}this.clipboardAction=new _clipboardAction2.default({action:this.action(trigger),target:this.target(trigger),text:this.text(trigger),container:this.container,trigger:trigger,emitter:this})}},{key:"defaultAction",value:function defaultAction(trigger){return getAttributeValue("action",trigger)}},{key:"defaultTarget",value:function defaultTarget(trigger){var selector=getAttributeValue("target",trigger);if(selector){return document.querySelector(selector)}}},{key:"defaultText",value:function defaultText(trigger){return getAttributeValue("text",trigger)}},{key:"destroy",value:function destroy(){this.listener.destroy();if(this.clipboardAction){this.clipboardAction.destroy();this.clipboardAction=null}}}],[{key:"isSupported",value:function isSupported(){var action=arguments.length>0&&arguments[0]!==undefined?arguments[0]:["copy","cut"];var actions=typeof action==="string"?[action]:action;var support=!!document.queryCommandSupported;actions.forEach(function(action){support=support&&!!document.queryCommandSupported(action)});return support}}]);return Clipboard}(_tinyEmitter2.default);function getAttributeValue(suffix,element){var attribute="data-clipboard-"+suffix;if(!element.hasAttribute(attribute)){return}return element.getAttribute(attribute)}module.exports=Clipboard})});var Clipboard=unwrapExports(clipboard);var ua=window.navigator.userAgent;var isAndroid=/android/i.test(ua);var isIOS=/iphone|ipad|ipod/i.test(ua);var isWinPhone=/Windows Phone/i.test(ua);var isQQ=/QQ\//i.test(ua);var isNewsapp=/newsapp\//i.test(ua);var isWechat=/MicroMessenger/i.test(ua);var isYixin=/yixin/i.test(ua);var isPopo=/POPO/i.test(ua);var isQzone=/Qzone/i.test(ua);var isWeibo=/weibo/i.test(ua);var isBaidu=/baidu/i.test(ua);var isToutiao=/NewsArticle/i.test(ua)||/TTWebView/i.test(ua);var isOpr=/OPR/i.test(ua);var isSogou=/Sogou/i.test(ua);var isUc=/UCBrowser/i.test(ua);var isFirefox=/Firefox/i.test(ua);var isSamsung=/SamsungBrowser/i.test(ua);var isHuawei=/Huawei/i.test(ua);var isIOSSafari=function(){var reg=/applewebkit\/\d+(\.\d+)*\d+\s*\(KHTML,\s*like\s*Gecko\)\s*version\/\d+(\.\d+)*\.\d+\s*mobile\/\d+\w\d+\s*safari\/\d+(\.\d+)*\.\d+$/i;return reg.test(ua)&&!window.hasOwnProperty("isLBBrowser")}();var isQQBrowser=function(){if(isIOS){return/MQQBrowser/i.test(ua)}else if(/MQQBrowser/i.test(ua)&&!isQQ&&!isWechat){return true}return false}();function detectIOS9(){var getIOSVersions=function getIOSVersions(){if(isIOS){var reg=/OS ((\d+_?){2,3})\s/;var versionMatchs=reg.exec(ua);if(versionMatchs&&versionMatchs.length>0){return versionMatchs[0].replace("OS","").replace("os","").replace(/\s+/g,"").replace(/_/g,".")}}return""};var iOSVersionArr=getIOSVersions().split(".");if(iOSVersionArr&&iOSVersionArr.length>0){if(parseInt(iOSVersionArr[0])>=9){return true}}return false}var isIOS9=detectIOS9();var SEARCH=function(){var s=window.location.search;var fn=function fn(str,reg){var data={};if(str){str.replace(reg,function($0,$1,$2,$3){data[$1]=$3});return data}return null};return fn(s,new RegExp("([^?=&]+)(=([^&]*))?","g"))||{}}();var isNewsAppLiteLink=SEARCH.spss==="newsapp-lite";var schemaPrefix=isNewsAppLiteLink?"newsapplite":"newsapp";var isTencentMarketCase=(isQQ||isQQBrowser||isAndroid&&isWechat)&&!(isIOS&&isNewsAppLiteLink);var isDisableToast=isWechat||isQzone||isWeibo||isBaidu||isOpr||isSogou||isUc||isFirefox||isSamsung||isHuawei;var isAndroidHd=function isAndroidHd(){return/(TAH-AN00m|JDN-W09|MI PAD 4|JDN-AL00|FDR-A03L|BAH-W09|FDR-A01w|AGS-W09|SM-F9160|SCM-W09|MI PAD 4 PLUS|AGS2-W09|AGS2-W09HN|SCMR-W09|MRX-W09|BAH2-W09|BAH3-W09|HUAWEI M2-801W|MRX-AL09|MI PAD|AGS-L09|MRX-W29|CMR-W09|HDN-W09|SM-T580|BAH-AL00|HUAWEI M2-803L|SM-T510|Lenovo TB-8703F|T1-821w|AGS2-AL00|Lenovo TB-X606F|TAH-AN00|Nexus 7|MI PAD 3|SCM-AL09|SM-T350|EBEN 80008|T1-A21w|HUAWEI M2-A01W|BAH2-AL10|KRJ-W09|SM-T550|BAH3-W59|EBEN T9|BAH3-AL00|SM-T560NU|CMR-AL09|Lenovo TB-8804F)/i.test(ua)};var isIpad=function isIpad(){return/ipad/i.test(ua)||/Mac OS X/i.test(ua)&&parseInt((ua.match(/Version\/(\d+)\./i)||[0,0])[1])>=13&&Math.min(screen.width,window.innerWidth)>=768};var gData={NUID:"",UUID:"",SPSP:"",SPSRF:"",PROJECT_ID:"",PARAM:"",ARGS:"",CHANNEL:""};function getReferFrom(){var domainMatches=[{test:/163\.com$/i,domain:"163"},{test:/baidu\.com$/i,domain:"baidu"},{test:/sm\.cn$/i,domain:"sm"},{test:/sogou\.com$/i,domain:"sogou"},{test:/so\.com$/i,domain:"360"},{test:/google/i,domain:"google"},{test:/bing/i,domain:"bing"},{test:/weibo/i,domain:"weibo"},{test:/toutiao/i,domain:"toutiao"}];var referrer=document.referrer;var referDomain="";var currentPageRefer="";if(referrer){var urlRegexp=/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)([^\/]+).*?/;var urlMatch=referrer.match(urlRegexp);referDomain=urlMatch&&urlMatch[2]?urlMatch[2]:referDomain}if(referDomain){currentPageRefer=referDomain;domainMatches.some(function(item){if(item.test.test(referDomain)){currentPageRefer=item.domain;return true}return false})}var urlSearchReferFrom=SEARCH.referFrom;if(/referFrom/.test(window.location.search)&&currentPageRefer=="163"){currentPageRefer=urlSearchReferFrom||""}return currentPageRefer}var referFrom=getReferFrom();window.addEventListener("NTMReady",function(){gData.NUID=window.NTESAntAnalysis&&window.NTESAntAnalysis.info&&window.NTESAntAnalysis.info.uid});gData.NUID=window.NTESAntAnalysis&&window.NTESAntAnalysis.info&&window.NTESAntAnalysis.info.uid;if(isWechat){gData.SPSP=SEARCH.from?"wx:".concat(SEARCH.from):"wx"}else if(isQQ){gData.SPSP="qq"}else if(isWeibo){gData.SPSP="wb"}else if(isYixin){gData.SPSP="yx"}else if(isToutiao){gData.SPSP="toutiao"}else if(isBaidu){gData.SPSP="baidu"}else if(isUc){gData.SPSP="uc"}else if(isQQBrowser){gData.SPSP="qqBrowser"}else if(isSogou){gData.SPSP="sogou"}gData.SPSS=SEARCH.spss?SEARCH.spss:isNewsapp?"native":referFrom==="163"?"163":"other";gData.SPSRF=referFrom;function renderToast(){if(isDisableToast){return}document.body.insertAdjacentHTML("beforeend",'\n    <style>\n    .toast-wrap-d7fef5 { display: none; position: fixed;z-index:99999998;left: 0;top: 0; width: 100%; height: 100%; }\n    .mask-d7fef5 { height: 100%; opacity: 0; -webkit-transition: opacity 0.2s ease-in-out; transition: opacity 0.2s ease-in-out; background: rgba(0,0,0,0.6)}\n    .toast-wrap-d7fef5.active .mask-d7fef5 { opacity: 1;}\n    .toast-d7fef5 {\n      position:absolute;z-index:99999999;left:0;bottom: 0;width:100%;\n      -webkit-transform: translateY(100%); -webkit-transition:-webkit-transform 0.2s ease-in-out;\n      transform: translateY(100%); transition: transform 0.2s ease-in-out;\n    }\n    .toast-wrap-d7fef5.active .toast-d7fef5 { -webkit-transform: translateY(0); transform: translateY(0); }\n    \n    .btn-d7fef5 { position: absolute; right:0;left:0;bottom:14.52%; height: 23.93%; }\n    </style>\n    <div class="toast-wrap-d7fef5">\n      <div class="mask-d7fef5"></div>\n      <div class="toast-d7fef5">\n        <div class="btn-d7fef5"></div>\n        <img src="//static.ws.126.net/163/frontend/images/toast-download.png" style="width: 100%; height: 100%; vertical-align: bottom;"/>\n      </div>\n    </div>\n  ');var toastWrap=document.querySelector(".toast-wrap-d7fef5");toastWrap.addEventListener("click",function(e){var classList=e.target.classList;var _e$target$dataset=e.target.dataset,href=_e$target$dataset.href,_e$target$dataset$cha=_e$target$dataset.channel,channel=_e$target$dataset$cha===void 0?"sps":_e$target$dataset$cha,spss=_e$target$dataset.spss,scheme=_e$target$dataset.scheme;if(classList.contains("btn-d7fef5")){window.NTESAntAnalysis&&window.NTESAntAnalysis.sendData({projectid:gData.PROJECT_ID,val_nm:"download",val_act:"module_layer_download",channel:channel,info:{spsid:gData.PROJECT_ID,spsuuid:gData.NUID,spsc:channel||"",spss:spss||SEARCH.spss,spspath:scheme.slice(0,-1)||""}});setTimeout(function(){if(document.hidden||document.webkitHidden)return;hideToast();window.top.location.href=href},100)}else{window.NTESAntAnalysis&&window.NTESAntAnalysis.sendData({projectid:gData.PROJECT_ID,val_nm:"click",val_act:"module_layer_close",channel:channel,info:{spsid:gData.PROJECT_ID,spsuuid:gData.NUID,spsc:channel||"",spss:spss||SEARCH.spss}});hideToast()}})}function showToast(href,channel,scheme,spss){var toastWrap=document.querySelector(".toast-wrap-d7fef5");if(toastWrap){window.NTESAntAnalysis&&window.NTESAntAnalysis.sendData({projectid:gData.PROJECT_ID,val_nm:"download",val_act:"module_layer_show",channel:channel,info:{spsid:gData.PROJECT_ID,spsuuid:gData.NUID,spsc:channel||"",spss:spss||SEARCH.spss,spspath:scheme.slice(0,-1)||""}});var button=toastWrap.querySelector(".btn-d7fef5");button.dataset.href=href;button.dataset.channel=channel;button.dataset.scheme=scheme;button.dataset.spss=spss;toastWrap.style.display="block";setTimeout(function(){toastWrap.classList.add("active")},0)}else{setTimeout(function(){if(document.hidden||document.webkitHidden)return;window.top.location.href=href},500)}}function hideToast(){var toastWrap=document.querySelector(".toast-wrap-d7fef5");toastWrap.classList.remove("active");setTimeout(function(){toastWrap.style.display="none"},200)}function jsonp(a,b,c){var d=document.createElement("script");d.src=a;d.charset=c||"utf-8";d.onload=function(){d.onload=null;d.onerror=null;d.parentNode.removeChild(d);b&&b(!0)};d.onerror=function(){d.onload=null;d.onerror=null;d.parentNode.removeChild(d);b&&b(!1)};document.head.appendChild(d)}function getIframe(){var ifr=document.getElementById("open_newsapp_iframe");if(ifr){return ifr}var iframe=document.createElement("iframe");iframe.id="open_newsapp_iframe";iframe.style.display="none";document.body.appendChild(iframe);return iframe}function silenceOpen(url){var iframe=getIframe();iframe.src=url}var request=function request(method,url,cb){var xhr=new window.XMLHttpRequest;xhr.open(method.toUpperCase(),url);xhr.onload=function(){cb(null,{data:xhr.response,status:xhr.status})};xhr.onerror=function(){cb(new Error("error"),{data:null,status:xhr.status})};xhr.send()};function openByXhr(scheme,isUseXhr,cb){var param=scheme.replace(/spsp%3D(?:[^(%26)]*)/,function($1){return"".concat($1,"%3Axhr")});var isInvoked=false;var timer=setTimeout(function(){isInvoked=true;cb()},300);var invoke=function invoke(){if(!isInvoked){clearTimeout(timer);cb()}isInvoked=true};if(!isUseXhr){return invoke()}var count=0;var ports=[65417,54198,47362,36541,21882,14398,9128,8465,6698,5863,4726,3943,2887];ports.forEach(function(port){request("get","http://loc.ws.126.net:".concat(port,"/startup?scheme=").concat(param),function(err,res){if(err){count++;count===ports.length&&invoke()}else{res.data==="newsapp"&&clearTimeout(timer)}})})}var type=function type(str){return function(data){return str===Object.prototype.toString.call(data).slice(8,-1)}};var isObject=type("Object");var isString=type("String");var isFunction=type("Function");var urlParse=function urlParse(input,url){var params="";var parse=function parse(data){var kvs=[];for(var key in data){if(Object.prototype.hasOwnProperty.call(data,key)){kvs.push("".concat(encodeURIComponent(key),"=").concat(encodeURIComponent(data[key])))}}return kvs.join("&")};isObject(input)&&(params=parse(input));if(isString(input)){if(/\{.*\}/.test(input)){try{params=parse(JSON.parse(input))}catch(error){console.error(error)}}else{params=input}}if(url){return url+(params?/\?/.test(url)?"&":"?":"")+params}return params};var createTextarea=function createTextarea(){var id=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"select_value_textarea";var textarea=document.getElementById(id);if(textarea){return textarea}textarea=document.createElement("textarea");textarea.id=id;textarea.tabIndex=-1;textarea.style.cssText="position: absolute; top: -1000px; left: -1000px";document.body.appendChild(textarea);return textarea};var copy=function copy(content,cb){var textarea=createTextarea();var status;textarea.value=content;textarea.setAttribute("readonly","");textarea.select();textarea.setSelectionRange(0,textarea.value.length);try{status=document.execCommand("copy")}catch(error){status=false;console.error(error)}textarea.removeAttribute("readonly");document.activeElement.blur();window.getSelection().removeAllRanges();isFunction(cb)&&cb({status:status?"success":"fail",content:content})};var localParam=function localParam(search,hash){var s=search||window.location.search;var h=hash||window.location.hash;var fn=function fn(str,reg){var data={};if(str){str.replace(reg,function($0,$1,$2,$3){data[$1]=$3});return data}return null};return{search:fn(s,new RegExp("([^?=&]+)(=([^&]*))?","g"))||{},hash:fn(h,new RegExp("([^#=&]+)(=([^&]*))?","g"))||{}}};var addUrlSearch=function addUrlSearch(url,obj){if(!url||!obj||!isObject(obj)){return url}var searchStart=url.indexOf("?");var searchText=obj.key+"="+obj.value;if(searchStart===-1){var hashSplits=url.split("#");url=hashSplits[0]+"?"+searchText+(hashSplits[1]?"#"+hashSplits[1]:"")}else{var searchSplits=url.split("?");if(searchSplits[1]&&localParam(searchSplits[1]).search[obj.key]){return url}url=searchSplits[0]+"?"+searchText+(searchSplits[1]?"&"+searchSplits[1]:"")}return url};var NEWS_TYPES=[{type:"startup",reg:"^startup",scheme:"{{param}}"},{type:"wendaQuestion",reg:"^wt.*",scheme:"wendaquestion/{{param}}"},{type:"wendaAnswer",reg:"^hd.*",scheme:"wendaanswer/{{param}}"},{type:"web",reg:"^https?",scheme:"web/{{param}}"},{type:"article",reg:"^[A-Z0-9]{16}$",scheme:"doc/{{param}}"},{type:"special",reg:"^S[0-9]{13}$",scheme:"topic/{{param}}"},{type:"videoSpecial",reg:"^SV[0-9]{13}$",scheme:"vtopic/{{param}}"},{type:"photo",reg:"^\\d{4}\\/\\d{1,}",scheme:"photo/{{param}}"},{type:"live",reg:"^live\\/\\d{1,}",scheme:"{{param}}"},{type:"shortVideo",reg:"^shortvideo\\/",scheme:"{{param}}"},{type:"video",reg:"^V",scheme:"video/{{param}}"},{type:"reader",reg:"^reader",scheme:"{{param}}"},{type:"channel",reg:"^channel",scheme:"{{param}}"},{type:"tie",reg:"^tie",scheme:"{{param}}"},{type:"expert",reg:"^EX-?[0-9]+",scheme:"expert/{{param}}"},{type:"subject",reg:"^SJ[0-9]+",scheme:"subject/{{param}}"},{type:"luobo",reg:"^luobo\\/[0-9]+",scheme:"{{param}}/1"},{type:"mint",reg:"^mint\\/[0-9]+",scheme:"{{param}}"},{type:"book",reg:"^book\\/",scheme:"http://m.yuedu.163.com/reader/{{param}}"},{type:"shortnews",reg:"^shortnews\\/",scheme:"{{param}}"}];function getScheme(param,queries){if(/^\//.test(param)){param=param.slice(1)}var news=getNewsType(param);var scheme=news.scheme.replace("{{param}}",param);if(news.type==="web"){scheme=news.scheme.replace("{{param}}",encodeURIComponent(param))}if(news.type==="book"){scheme="web/"+encodeURIComponent(scheme)}scheme=urlParse(queries,scheme);scheme+=scheme.indexOf("?")>=0?"&":"?";return scheme}function getNewsType(param){var type=NEWS_TYPES.filter(function(t){return new RegExp(t.reg).test(param)})[0];if(type){return type}if(param){return{scheme:"{{param}}"}}return NEWS_TYPES[0]}var defaultConfig={androidDownloadUrl:"//static.ws.126.net/163/apk/newsapp/newsreader_sps_article.apk",appStoreLink:"https://itunes.apple.com/app/apple-store/id425349261?pt=104792803&ct=huiliu_8&mt=8",tencentMarket:"//a.app.qq.com/o/simple.jsp?pkgname=com.netease.newsreader.activity&ckey=CK1453551940543"};function getConfig(spsc){var CONFIGS=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var cb=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(){};if(!spsc||spsc.length>27){return}if(isNewsAppLiteLink){jsonp("//channel.m.163.com/data/d/iosTracking/spslite/click?callback=".concat(spsc,"&nuid=").concat(gData.NUID,"&projectid=").concat(gData.PROJECT_ID,"&source=").concat(SEARCH.spss||""))}else{jsonp("//channel.m.163.com/data/d/iosTracking/".concat(spsc,"/click?callback=").concat(spsc,"&nuid=").concat(gData.NUID,"&projectid=").concat(gData.PROJECT_ID,"&source=").concat(SEARCH.spss||""))}window[spsc]=function(data){window[spsc]=null;if(data&&data.channel){CONFIGS[spsc]=data.channel;CONFIGS[spsc].androidDownloadUrl=CONFIGS[spsc].androidDownloadUrl||defaultConfig.androidDownloadUrl;CONFIGS[spsc].appStoreLink=CONFIGS[spsc].appStoreLink||defaultConfig.appStoreLink;CONFIGS[spsc].tencentMarket=CONFIGS[spsc].tencentMarket||defaultConfig.tencentMarket;isAndroidHd()&&(CONFIGS[spsc].androidDownloadUrl="https://mobilepics.ws.126.net/O21SqwMzamz2%3DwOv4QVXaF9wqIeZswNe%3D%3DHLJKPSH0.apk");isIpad()&&(CONFIGS[spsc].appStoreLink="https://itunes.apple.com/app/apple-store/id1538717280");if(data.uuid&&!gData.UUID){gData.UUID=data.uuid}}else{CONFIGS[spsc]=defaultConfig}cb&&cb()}}var version="7.4.4";var INIT=false;var CONFIGS={};var isUseXhr=isAndroid;var DOWNLOAD_URL="https://m.163.com/newsapp/applinks.html";function init(_ref){var projectId=_ref.projectId,_ref$args=_ref.args,args=_ref$args===void 0?"":_ref$args,_ref$param=_ref.param,param=_ref$param===void 0?"nc":_ref$param,_ref$channels=_ref.channels,channels=_ref$channels===void 0?"sps":_ref$channels,_ref$callback=_ref.callback,callback=_ref$callback===void 0?function(){}:_ref$callback,queries=_ref.queries;INIT=true;gData.PARAM=param;gData.PROJECT_ID=projectId;gData.ARGS=args;gData.QUERIES=queries;var spsc=SEARCH.spsc;if(spsc){if(Array.isArray(channels)){channels.indexOf(spsc)===-1&&channels.unshift(spsc)}else if(isString(channels)){if(channels!==spsc){channels=[spsc,channels]}}}if(Array.isArray(channels)){var channelsLen=channels.length;gData.CHANNEL=channels[0];var completeIndex=0;var checkComplete=function checkComplete(){completeIndex++;if(completeIndex===channelsLen){callback()}};for(var i=0;i<channelsLen;i++){getConfig(channels[i],CONFIGS,checkComplete)}}else{gData.CHANNEL=channels;getConfig(channels,CONFIGS,callback)}renderToast()}function bind(_ref2){var selector=_ref2.selector,_ref2$download=_ref2.download,download=_ref2$download===void 0?false:_ref2$download,_ref2$param=_ref2.param,param=_ref2$param===void 0?gData.PARAM:_ref2$param,_ref2$args=_ref2.args,args=_ref2$args===void 0?gData.ARGS:_ref2$args,_ref2$channel=_ref2.channel,channel=_ref2$channel===void 0?gData.CHANNEL:_ref2$channel,_ref2$projectId=_ref2.projectId,projectId=_ref2$projectId===void 0?gData.PROJECT_ID:_ref2$projectId,_ref2$mod=_ref2.mod,mod=_ref2$mod===void 0?"":_ref2$mod,_ref2$beforeOpen=_ref2.beforeOpen,beforeOpen=_ref2$beforeOpen===void 0?function(){}:_ref2$beforeOpen,redirect=_ref2.redirect,_ref2$queries=_ref2.queries,queries=_ref2$queries===void 0?gData.QUERIES:_ref2$queries;if(!INIT){throw new Error("\u5fc5\u987b\u63d0\u524d\u8c03\u7528init\u65b9\u6cd5")}if(typeof selector==="string"){Array.prototype.forEach.call(document.querySelectorAll(selector),function(element){element.style.cssText+="cursor: pointer;"})}else if(selector instanceof HTMLElement){selector.style.cssText+="cursor: pointer;"}else if(selector instanceof HTMLCollection||selector instanceof NodeList){Array.prototype.forEach.call(selector,function(element){element.style.cssText+="cursor: pointer;"})}var clipboard=new Clipboard(selector,{text:function text(trigger){return getClipboardContent({param:trigger.dataset.param||param,args:trigger.dataset.args||args,channel:trigger.dataset.channel||channel,mod:trigger.dataset.mod||mod,queries:trigger.dataset.queries||queries})}});var onOpen=function onOpen(e){beforeOpen(e.trigger,e);open({param:e.trigger.dataset.param||param,channel:e.trigger.dataset.channel||channel,mod:e.trigger.dataset.mod||mod,args:e.trigger.dataset.args||args,download:e.trigger.dataset.download||download,projectId:projectId,redirect:e.trigger.dataset.redirect||redirect,queries:e.trigger.dataset.queries||queries})};clipboard.on("success",function(e){onOpen(e)});clipboard.on("error",function(e){onOpen(e)})}function open(_ref3){var _ref3$param=_ref3.param,param=_ref3$param===void 0?gData.PARAM:_ref3$param,_ref3$download=_ref3.download,download=_ref3$download===void 0?false:_ref3$download,_ref3$channel=_ref3.channel,channel=_ref3$channel===void 0?gData.CHANNEL:_ref3$channel,_ref3$args=_ref3.args,args=_ref3$args===void 0?gData.ARGS:_ref3$args,_ref3$redirect=_ref3.redirect,redirect=_ref3$redirect===void 0?"":_ref3$redirect,_ref3$projectId=_ref3.projectId,projectId=_ref3$projectId===void 0?gData.PROJECT_ID:_ref3$projectId,_ref3$mod=_ref3.mod,mod=_ref3$mod===void 0?"":_ref3$mod,_ref3$spss=_ref3.spss,spss=_ref3$spss===void 0?"":_ref3$spss,_ref3$queries=_ref3.queries,queries=_ref3$queries===void 0?gData.QUERIES:_ref3$queries;if(!INIT){renderToast()}window.NTESAntAnalysis&&window.NTESAntAnalysis.sendData({projectid:projectId,val_nm:"download",val_act:"module_all",channel:channel,info:{spsid:projectId,spsuuid:gData.NUID,spsc:channel,spss:spss||gData.SPSS,spspath:getScheme(param,queries).slice(0,-1),spsmod:mod}});var config=CONFIGS[channel];if(!config){console.warn("\u672a\u627e\u5230\u6e20\u9053".concat(channel,"\u5bf9\u5e94\u7684\u914d\u7f6e\u5305\uff0c\u8bf7\u67e5\u770b\u540e\u53f0\u662f\u5426\u914d\u7f6e\u53cainit\u65b9\u6cd5\u7684\u53c2\u6570channles\u4e2d\u662f\u5426\u5305\u542b").concat(channel));config=defaultConfig}if(isTencentMarketCase){DOWNLOAD_URL=config.tencentMarket}else if(isIOS||isIpad()){DOWNLOAD_URL=config.appStoreLink}else if(isAndroid){DOWNLOAD_URL=config.androidDownloadUrl}if(download){window.top.location.href=DOWNLOAD_URL.replace("{CHANNLE}",channel);return}var scheme=getScheme(param,queries);var openParams="s=".concat(channel,"&spsc=").concat(channel,"&spss=").concat(spss||gData.SPSS,"&spsp=").concat(gData.SPSP,"&spsid=").concat(projectId,"&spsuuid=").concat(gData.NUID,"&spsw=").concat(SEARCH.spsw||1,"&spssurl=").concat(encodeURIComponent(window.location.pathname),"&spsrf=").concat(gData.SPSRF,"&spsmod=").concat(mod);if(args){openParams="".concat(openParams,"&").concat(args)}isUseXhr&&(openParams="".concat(openParams,"&ts=").concat(Date.now()));var androidScheme="".concat(schemaPrefix,"://").concat(scheme).concat(openParams);var wechatScheme=encodeURIComponent(androidScheme);var path=encodeURIComponent("/"+scheme.slice(0,-1));var prevent="&prevent=1";var downloadPage=isNewsAppLiteLink?"//wp.m.163.com/163/html/newsapplite/applinks.html?path=".concat(path,"&").concat(openParams).concat(prevent):"//m.163.com/newsapp/applinks.html?path=".concat(path,"&").concat(openParams).concat(prevent);if(redirect){if(isAndroid){silenceOpen(androidScheme);setTimeout(function(){var href=decodeURIComponent(redirect);if(href.match(/^\/\//)){href="https:"+href}var isNetease=false;if(typeof window.URL==="function"&&new window.URL(href).hostname.indexOf("163.com")>-1){isNetease=true}else if(href.indexOf("163.com")>-1){isNetease=true}if(!href.match(/^\s*javascript:/)&&isNetease){window.top.location.href="".concat(downloadPage,"&redirect=").concat(encodeURIComponent(redirect))}},120)}else{if(isNewsAppLiteLink){window.top.location.href="//wp.m.163.com/163/html/newsapplite/applinks.html?path=".concat(path,"&redirect=").concat(encodeURIComponent(redirect),"&spssurl=").concat(encodeURIComponent(window.location.pathname))}else{window.top.location.href="".concat(downloadPage,"&redirect=").concat(encodeURIComponent(redirect))}}return}var unSchemaOpenApp=function unSchemaOpenApp(isOpenRedirect){openByXhr(wechatScheme,isUseXhr,function(){if(isTencentMarketCase){var pkgname=isNewsAppLiteLink?"com.netease.news.lite":"com.netease.newsreader.activity";var tencent="http://a.app.qq.com/o/simple.jsp?pkgname=".concat(pkgname,"&ckey=CK1331205846719&android_schema=").concat(wechatScheme,"&ios_schema=").concat(wechatScheme);if(config.tencentMarket){config.tencentMarket=config.tencentMarket.replace(/com\.netease\.newsreader\.activity/,pkgname);if(config.tencentMarket.indexOf("android_schema")>0){tencent=config.tencentMarket.replace(/newsapp(-lite)?:\/\/startup.*/,wechatScheme)}else{tencent=config.tencentMarket+"&android_schema="+wechatScheme}tencent+="&ios_schema=".concat(wechatScheme);window.top.location.href=tencent}else{window.top.location.href=downloadPage}return}if(!isAndroid||isWeibo||isWechat){var currentUrl=window.location.host+window.location.pathname;var isApplinkPage=["m.163.com/newsapp/applinks.html","wp.m.163.com/163/html/newsapplite/applinks.html"].indexOf(currentUrl)>-1;if(!isApplinkPage){var redirectUrl=addUrlSearch(window.location.href,{key:"unfoldAll",value:"1"});window.top.location.href=isOpenRedirect?"".concat(downloadPage,"&redirect=").concat(encodeURIComponent(redirectUrl)):downloadPage}return}if(isAndroid){showToast(config.androidDownloadUrl,channel,scheme,spss)}})};var isSchemaOpen=true;if(isIOS){if(isWeibo||isUc||isToutiao){isSchemaOpen=true}else{isSchemaOpen=false}}if(isAndroid){if(isWechat||isQQ||isQQBrowser||isUc){isSchemaOpen=false}}var isOpenRedirect=false;if(isIOS&&isToutiao){isOpenRedirect=true}if(isSchemaOpen){silenceOpen(androidScheme);bindSchemaOpenFail(function(){unSchemaOpenApp(isOpenRedirect)})}else{unSchemaOpenApp()}}function bindSchemaOpenFail(callback){var start=Date.now();var time=isIOS?3e3:1200;var loadTimer=setTimeout(function(){if(document.hidden||document.webkitHidden){return}if(Date.now()-start>time+200);else{callback()}},time);var visibilitychange=function visibilitychange(){if(document.hidden||document.webkitHidden){clearTimeout(loadTimer)}};document.addEventListener("visibilitychange",visibilitychange,false);document.addEventListener("webkitvisibilitychange",visibilitychange,false);window.addEventListener("pagehide",function(){clearTimeout(loadTimer)},false)}function getCompleteScheme(){var param=arguments.length>0&&arguments[0]!==undefined?arguments[0]:gData.PARAM;var queries=arguments.length>1&&arguments[1]!==undefined?arguments[1]:gData.QUERIES;var schemePath=getScheme(param,queries);var openParams="s=".concat(gData.CHANNEL,"&spsc=").concat(gData.CHANNEL,"&spss=").concat(gData.SPSS,"&spsp=").concat(gData.SPSP,"&spssurl=").concat(encodeURIComponent(window.location.pathname),"&spsid=").concat(gData.PROJECT_ID,"&spsuuid=").concat(gData.NUID,"&spsw=").concat(SEARCH.spsw||1,"&spsrf=").concat(gData.SPSRF);if(gData.ARGS){openParams="".concat(openParams,"&").concat(gData.ARGS)}return"".concat(schemePath).concat(openParams)}function getClipboardContent(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _options$param=options.param,param=_options$param===void 0?gData.PARAM:_options$param,_options$args=options.args,args=_options$args===void 0?gData.ARGS:_options$args,_options$channel=options.channel,channel=_options$channel===void 0?gData.CHANNEL:_options$channel,_options$mod=options.mod,mod=_options$mod===void 0?"":_options$mod,_options$queries=options.queries,queries=_options$queries===void 0?gData.QUERIES:_options$queries;var scheme="".concat(getScheme(param,queries),"s=CH_").concat(channel,"&spsp=").concat(gData.SPSP,"&spss=").concat(gData.SPSS,"&spsid=").concat(gData.PROJECT_ID,"&spsuuid=").concat(gData.NUID,"&spsrf=").concat(gData.SPSRF,"&spsmod=").concat(mod);if(args){scheme="".concat(scheme,"&").concat(args)}var time=Date.now()+10*60*1e3;return"\u7f51\u6613 `{{".concat(schemaPrefix,"://").concat(scheme,"}}` !{{").concat(time,"}}! ${{").concat(channel,"}}$ ^{{").concat(gData.UUID,"}}^ ")}function copyExpandContent(){var queries=arguments.length>0&&arguments[0]!==undefined?arguments[0]:gData.QUERIES;var callback=arguments.length>1?arguments[1]:undefined;copy("\u7f51\u6613 %{{".concat(urlParse(queries),"}}%"),callback)}exports.bind=bind;exports.copyExpandContent=copyExpandContent;exports.getClipboardContent=getClipboardContent;exports.getCompleteScheme=getCompleteScheme;exports.init=init;exports.open=open;exports.version=version;Object.defineProperty(exports,"__esModule",{value:true})});